---
apiVersion: v1
kind: Secret
metadata:
  name: traefik
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repository
  annotations:
    argocd.argoproj.io/tracking-id: "repo-traefik"
stringData:
  url: https://traefik.github.io/charts
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik
  namespace: argocd
  annotations:
    argocd.argoproj.io/tracking-id: "traefik"
spec:
  project: default
  sources:
    - repoURL: https://traefik.github.io/charts
      targetRevision: HEAD
      helm:
        version: v3
        releaseName: traefik
        namespace: kube-system
        valuesObject:
          logs:
            level: INFO
            access:
              enabled: true

          providers:
            kubernetesCRD:
              allowCrossNamespace: true

          dashboard:
            enabled: true
          api:
            insecure: true
            dashboard: true

  destination:
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
      enabled: true
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: traefik-dashboard-ingress
  namespace: kube-system
spec:
  tls:
    secretName: traefik-tls
  entryPoints:
    - websecure
  routes:
    - kind: Rule
      match: Host(`traefik.kube.internal`)
      services:
        - name: api@internal
          kind: TraefikService
